{% extends "base.html" %}

{% block title %} j2a {% endblock %}

{% block header %}
<style>
    .container {
      height: 100%;
    }

    button.is-disabled {
      pointer-events: none!important;
    }

    .form .field {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .hidden {
      display: none;
    }

    .removefile {
      z-index: 100;
    }

    label.header {
      color: #ffe837;
      width: 200px;
      text-align: right;
      padding-right: 16px;
    }

    #output {
      max-width: 100%;
      padding: 16px;
      border-radius: 5px;
      background-color: #4e4e4e;
      color: #fff;
      border: 1px solid #4e4e4e;
      font-size: 12px;
      overflow: auto;
    }

    @media only screen and (max-width: 767px) {
      .nes-container {
        font-size: 12px;
        padding: 1.5rem 8px;
      }

      .ui.container {
        margin-left: .5em!important;
        margin-right: .5em!important;
      }

      label.header {
        width: 120px;
      }
    }
</style>
{% endblock %}


{% block content %}
<section class="icon-list" style="margin-bottom: 20px">
    <!-- Copyright Nintendo -->
    <i class="nes-mario"></i>
    <i class="nes-ash"></i>
    <i class="nes-pokeball"></i>
    <i class="nes-bulbasaur"></i>
    <i class="nes-charmander"></i>
    <i class="nes-squirtle"></i>
    <i class="nes-kirby"></i>
    <i class="nes-octocat animate"></i>
</section>

<div class="nes-container with-title">
  <p class="title">Form</p>
  <div class="ui form">
    <div class="field">
      <label for="jpg" class="header">JPEG</label>
      <button id="uploadJPEGHandle" class="nes-btn" style="margin-right: 16px;">
          Choose
      </button>
      <input id="jpg" name="jpg" type="file" style="display: none">
      <i class="nes-icon removefile hidden close"></i>
    </div>
    <div class="field">
      <label class="header">Background</label>
      <label>
        <input type="radio" class="bg nes-radio" name="bg" value="dark" checked />
        <span>Dark</span>
      </label>
      <label>
        <input type="radio" class="bg nes-radio" name="bg" value="light" />
        <span>Light</span>
      </label>
    </div>
    <div class="field">
      <label class="header">Width</label>
      <label>
        <input type="radio" class="width nes-radio" name="width" value="80" checked />
        <span>80</span>
      </label>
      <label>
        <input type="radio" class="width nes-radio" name="width" value="60" />
        <span>60</span>
      </label>
      <label>
        <input type="radio" class="width nes-radio" name="width" value="40"/>
        <span>40</span>
      </label>
    </div>
  </div>

  <div class="">
    <button id="upload-button" type="button" class="nes-btn is-disabled">
        <i class="nes-icon coin" style="width: 0; height: 0; transform: scale(1);"></i> 
        <span class="process">Process</span>
    </button>
    <button id="copy-button" type="button" class="nes-btn is-success">Copy</button>
  </div>
 
</div>

<div class="nes-container with-title" style="margin-top: 30px; text-align: center;">
  <p class="title">Output</p>
  <div id="output"></div>
</div>

{% endblock %}


{% block footer %}
<script>
var ws = new WebSocket("ws://"+location.host+"/ws");

ws.onmessage = function(event) {
    var data = JSON.parse(event.data);

    if (data.type === 'upload') {
      // Upload complate;
      $('#upload-button').removeClass('is-disabled');
      $('#upload-button').addClass('is-primary');
    }
    
    $('#upload-button .process').html("Process")
    $('#output').html(data.output);
};

function sendMessage(event) {
  var bg = $('input.bg:checked').val();
  var width = $('input.width:checked').val();

  ws.send(JSON.stringify({"background": bg, "width": width}))
}

$(document).ready(function() {
  $('#upload-button').on('click', function () {
    $('#upload-button .process').html("Processing..")
    sendMessage()
  })

  $('.removefile').on('click', function (e) {
    $('#uploadJPEGHandle').html('Choose')
    $('.removefile').addClass('hidden')
    $('#jpg').val('');

    $('#upload-button').addClass('is-disabled');
    $('#upload-button').removeClass('is-primary');
  })

  $('#jpg').on('change', function (e) {
    var fileName = e.target.files[0].name;
    var fileName = 'image.' + fileName.split('.')[1];
    $('#uploadJPEGHandle').html(fileName)
    $('.removefile').removeClass('hidden');

    // upload file 
    $('#upload-button .process').html("Uploading..")
    var file = $('#jpg')[0].files[0];
    ws.send(file)
  })

  $('#uploadJPEGHandle').on('click', function (e) {
    $('#jpg').trigger("click");
  })

});
</script>
{% endblock %}